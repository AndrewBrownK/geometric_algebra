use std::collections::{BTreeMap, BTreeSet};
use crate::algebra::basis_element::BasisElement;
use crate::algebra::conformal::ConformalGeometricAlgebra;
use crate::algebra::dialect::Dialect;
use crate::algebra::GeometricAlgebraTrait;

#[test]
fn conformal_3d_geometric_products() {
    let dialect = Dialect::default();
    let cga3d = ConformalGeometricAlgebra::new("cga3d", 3, dialect);
    // https://conformalgeometricalgebra.org/wiki/index.php?title=Geometric_products
    let correct_cayley_table = [
        ("1", "1", vec!["1"]), ("1", "e1", vec!["e1"]), ("1", "e2", vec!["e2"]), ("1", "e3", vec!["e3"]), ("1", "e4", vec!["e4"]), ("1", "e23", vec!["e23"]), ("1", "e31", vec!["e31"]), ("1", "e12", vec!["e12"]), ("1", "e43", vec!["e43"]), ("1", "e42", vec!["e42"]), ("1", "e41", vec!["e41"]), ("1", "e321", vec!["e321"]), ("1", "e412", vec!["e412"]), ("1", "e431", vec!["e431"]), ("1", "e423", vec!["e423"]), ("1", "e1234", vec!["e1234"]), ("1", "e5", vec!["e5"]), ("1", "e15", vec!["e15"]), ("1", "e25", vec!["e25"]), ("1", "e35", vec!["e35"]), ("1", "e45", vec!["e45"]), ("1", "e235", vec!["e235"]), ("1", "e315", vec!["e315"]), ("1", "e125", vec!["e125"]), ("1", "e435", vec!["e435"]), ("1", "e425", vec!["e425"]), ("1", "e415", vec!["e415"]), ("1", "e3215", vec!["e3215"]), ("1", "e4125", vec!["e4125"]), ("1", "e4315", vec!["e4315"]), ("1", "e4235", vec!["e4235"]), ("1", "e12345", vec!["e12345"]),
        ("e1", "1", vec!["e1"]), ("e1", "e1", vec!["1"]), ("e1", "e2", vec!["e12"]), ("e1", "e3", vec!["-e31"]), ("e1", "e4", vec!["-e41"]), ("e1", "e23", vec!["-e321"]), ("e1", "e31", vec!["-e3"]), ("e1", "e12", vec!["e2"]), ("e1", "e43", vec!["e431"]), ("e1", "e42", vec!["-e412"]), ("e1", "e41", vec!["-e4"]), ("e1", "e321", vec!["-e23"]), ("e1", "e412", vec!["-e42"]), ("e1", "e431", vec!["e43"]), ("e1", "e423", vec!["e1234"]), ("e1", "e1234", vec!["e423"]), ("e1", "e5", vec!["e15"]), ("e1", "e15", vec!["e5"]), ("e1", "e25", vec!["e125"]), ("e1", "e35", vec!["-e315"]), ("e1", "e45", vec!["-e415"]), ("e1", "e235", vec!["-e3215"]), ("e1", "e315", vec!["-e35"]), ("e1", "e125", vec!["e25"]), ("e1", "e435", vec!["e4315"]), ("e1", "e425", vec!["-e4125"]), ("e1", "e415", vec!["-e45"]), ("e1", "e3215", vec!["-e235"]), ("e1", "e4125", vec!["-e425"]), ("e1", "e4315", vec!["e435"]), ("e1", "e4235", vec!["e12345"]), ("e1", "e12345", vec!["e4235"]),
        ("e2", "1", vec!["e2"]), ("e2", "e1", vec!["-e12"]), ("e2", "e2", vec!["1"]), ("e2", "e3", vec!["e23"]), ("e2", "e4", vec!["-e42"]), ("e2", "e23", vec!["e3"]), ("e2", "e31", vec!["-e321"]), ("e2", "e12", vec!["-e1"]), ("e2", "e43", vec!["-e423"]), ("e2", "e42", vec!["-e4"]), ("e2", "e41", vec!["e412"]), ("e2", "e321", vec!["-e31"]), ("e2", "e412", vec!["e41"]), ("e2", "e431", vec!["e1234"]), ("e2", "e423", vec!["-e43"]), ("e2", "e1234", vec!["e431"]), ("e2", "e5", vec!["e25"]), ("e2", "e15", vec!["-e125"]), ("e2", "e25", vec!["e5"]), ("e2", "e35", vec!["e235"]), ("e2", "e45", vec!["-e425"]), ("e2", "e235", vec!["e35"]), ("e2", "e315", vec!["-e3215"]), ("e2", "e125", vec!["-e15"]), ("e2", "e435", vec!["-e4235"]), ("e2", "e425", vec!["-e45"]), ("e2", "e415", vec!["e4125"]), ("e2", "e3215", vec!["-e315"]), ("e2", "e4125", vec!["e415"]), ("e2", "e4315", vec!["e12345"]), ("e2", "e4235", vec!["-e435"]), ("e2", "e12345", vec!["e4315"]),
        ("e3", "1", vec!["e3"]), ("e3", "e1", vec!["e31"]), ("e3", "e2", vec!["-e23"]), ("e3", "e3", vec!["1"]), ("e3", "e4", vec!["-e43"]), ("e3", "e23", vec!["-e2"]), ("e3", "e31", vec!["e1"]), ("e3", "e12", vec!["-e321"]), ("e3", "e43", vec!["-e4"]), ("e3", "e42", vec!["e423"]), ("e3", "e41", vec!["-e431"]), ("e3", "e321", vec!["-e12"]), ("e3", "e412", vec!["e1234"]), ("e3", "e431", vec!["-e41"]), ("e3", "e423", vec!["e42"]), ("e3", "e1234", vec!["e412"]), ("e3", "e5", vec!["e35"]), ("e3", "e15", vec!["e315"]), ("e3", "e25", vec!["-e235"]), ("e3", "e35", vec!["e5"]), ("e3", "e45", vec!["-e435"]), ("e3", "e235", vec!["-e25"]), ("e3", "e315", vec!["e15"]), ("e3", "e125", vec!["-e3215"]), ("e3", "e435", vec!["-e45"]), ("e3", "e425", vec!["e4235"]), ("e3", "e415", vec!["-e4315"]), ("e3", "e3215", vec!["-e125"]), ("e3", "e4125", vec!["e12345"]), ("e3", "e4315", vec!["-e415"]), ("e3", "e4235", vec!["e425"]), ("e3", "e12345", vec!["e4125"]),
        ("e4", "1", vec!["e4"]), ("e4", "e1", vec!["e41"]), ("e4", "e2", vec!["e42"]), ("e4", "e3", vec!["e43"]), ("e4", "e4", vec![]), ("e4", "e23", vec!["e423"]), ("e4", "e31", vec!["e431"]), ("e4", "e12", vec!["e412"]), ("e4", "e43", vec![]), ("e4", "e42", vec![]), ("e4", "e41", vec![]), ("e4", "e321", vec!["e1234"]), ("e4", "e412", vec![]), ("e4", "e431", vec![]), ("e4", "e423", vec![]), ("e4", "e1234", vec![]), ("e4", "e5", vec!["e45", "-1"]), ("e4", "e15", vec!["e1", "e415"]), ("e4", "e25", vec!["e2", "e425"]), ("e4", "e35", vec!["e3", "e435"]), ("e4", "e45", vec!["e4"]), ("e4", "e235", vec!["e4235", "-e23"]), ("e4", "e315", vec!["e4315", "-e31"]), ("e4", "e125", vec!["e4125", "-e12"]), ("e4", "e435", vec!["-e43"]), ("e4", "e425", vec!["-e42"]), ("e4", "e415", vec!["-e41"]), ("e4", "e3215", vec!["e321", "e12345"]), ("e4", "e4125", vec!["e412"]), ("e4", "e4315", vec!["e431"]), ("e4", "e4235", vec!["e423"]), ("e4", "e12345", vec!["-e1234"]),
        ("e23", "1", vec!["e23"]), ("e23", "e1", vec!["-e321"]), ("e23", "e2", vec!["-e3"]), ("e23", "e3", vec!["e2"]), ("e23", "e4", vec!["e423"]), ("e23", "e23", vec!["-1"]), ("e23", "e31", vec!["-e12"]), ("e23", "e12", vec!["e31"]), ("e23", "e43", vec!["e42"]), ("e23", "e42", vec!["-e43"]), ("e23", "e41", vec!["-e1234"]), ("e23", "e321", vec!["e1"]), ("e23", "e412", vec!["e431"]), ("e23", "e431", vec!["-e412"]), ("e23", "e423", vec!["-e4"]), ("e23", "e1234", vec!["e41"]), ("e23", "e5", vec!["e235"]), ("e23", "e15", vec!["-e3215"]), ("e23", "e25", vec!["-e35"]), ("e23", "e35", vec!["e25"]), ("e23", "e45", vec!["e4235"]), ("e23", "e235", vec!["-e5"]), ("e23", "e315", vec!["-e125"]), ("e23", "e125", vec!["e315"]), ("e23", "e435", vec!["e425"]), ("e23", "e425", vec!["-e435"]), ("e23", "e415", vec!["-e12345"]), ("e23", "e3215", vec!["e15"]), ("e23", "e4125", vec!["e4315"]), ("e23", "e4315", vec!["-e4125"]), ("e23", "e4235", vec!["-e45"]), ("e23", "e12345", vec!["e415"]),
        ("e31", "1", vec!["e31"]), ("e31", "e1", vec!["e3"]), ("e31", "e2", vec!["-e321"]), ("e31", "e3", vec!["-e1"]), ("e31", "e4", vec!["e431"]), ("e31", "e23", vec!["e12"]), ("e31", "e31", vec!["-1"]), ("e31", "e12", vec!["-e23"]), ("e31", "e43", vec!["-e41"]), ("e31", "e42", vec!["-e1234"]), ("e31", "e41", vec!["e43"]), ("e31", "e321", vec!["e2"]), ("e31", "e412", vec!["-e423"]), ("e31", "e431", vec!["-e4"]), ("e31", "e423", vec!["e412"]), ("e31", "e1234", vec!["e42"]), ("e31", "e5", vec!["e315"]), ("e31", "e15", vec!["e35"]), ("e31", "e25", vec!["-e3215"]), ("e31", "e35", vec!["-e15"]), ("e31", "e45", vec!["e4315"]), ("e31", "e235", vec!["e125"]), ("e31", "e315", vec!["-e5"]), ("e31", "e125", vec!["-e235"]), ("e31", "e435", vec!["-e415"]), ("e31", "e425", vec!["-e12345"]), ("e31", "e415", vec!["e435"]), ("e31", "e3215", vec!["e25"]), ("e31", "e4125", vec!["-e4235"]), ("e31", "e4315", vec!["-e45"]), ("e31", "e4235", vec!["e4125"]), ("e31", "e12345", vec!["e425"]),
        ("e12", "1", vec!["e12"]), ("e12", "e1", vec!["-e2"]), ("e12", "e2", vec!["e1"]), ("e12", "e3", vec!["-e321"]), ("e12", "e4", vec!["e412"]), ("e12", "e23", vec!["-e31"]), ("e12", "e31", vec!["e23"]), ("e12", "e12", vec!["-1"]), ("e12", "e43", vec!["-e1234"]), ("e12", "e42", vec!["e41"]), ("e12", "e41", vec!["-e42"]), ("e12", "e321", vec!["e3"]), ("e12", "e412", vec!["-e4"]), ("e12", "e431", vec!["e423"]), ("e12", "e423", vec!["-e431"]), ("e12", "e1234", vec!["e43"]), ("e12", "e5", vec!["e125"]), ("e12", "e15", vec!["-e25"]), ("e12", "e25", vec!["e15"]), ("e12", "e35", vec!["-e3215"]), ("e12", "e45", vec!["e4125"]), ("e12", "e235", vec!["-e315"]), ("e12", "e315", vec!["e235"]), ("e12", "e125", vec!["-e5"]), ("e12", "e435", vec!["-e12345"]), ("e12", "e425", vec!["e415"]), ("e12", "e415", vec!["-e425"]), ("e12", "e3215", vec!["e35"]), ("e12", "e4125", vec!["-e45"]), ("e12", "e4315", vec!["e4235"]), ("e12", "e4235", vec!["-e4315"]), ("e12", "e12345", vec!["e435"]),
        ("e43", "1", vec!["e43"]), ("e43", "e1", vec!["e431"]), ("e43", "e2", vec!["-e423"]), ("e43", "e3", vec!["e4"]), ("e43", "e4", vec![]), ("e43", "e23", vec!["-e42"]), ("e43", "e31", vec!["e41"]), ("e43", "e12", vec!["-e1234"]), ("e43", "e43", vec![]), ("e43", "e42", vec![]), ("e43", "e41", vec![]), ("e43", "e321", vec!["-e412"]), ("e43", "e412", vec![]), ("e43", "e431", vec![]), ("e43", "e423", vec![]), ("e43", "e1234", vec![]), ("e43", "e5", vec!["e3", "e435"]), ("e43", "e15", vec!["e4315", "-e31"]), ("e43", "e25", vec!["e23", "-e4235"]), ("e43", "e35", vec!["e45", "-1"]), ("e43", "e45", vec!["e43"]), ("e43", "e235", vec!["-e2", "-e425"]), ("e43", "e315", vec!["e1", "e415"]), ("e43", "e125", vec!["-e321", "-e12345"]), ("e43", "e435", vec!["-e4"]), ("e43", "e425", vec!["e423"]), ("e43", "e415", vec!["-e431"]), ("e43", "e3215", vec!["e12", "-e4125"]), ("e43", "e4125", vec!["-e1234"]), ("e43", "e4315", vec!["e41"]), ("e43", "e4235", vec!["-e42"]), ("e43", "e12345", vec!["e412"]),
        ("e42", "1", vec!["e42"]), ("e42", "e1", vec!["-e412"]), ("e42", "e2", vec!["e4"]), ("e42", "e3", vec!["e423"]), ("e42", "e4", vec![]), ("e42", "e23", vec!["e43"]), ("e42", "e31", vec!["-e1234"]), ("e42", "e12", vec!["-e41"]), ("e42", "e43", vec![]), ("e42", "e42", vec![]), ("e42", "e41", vec![]), ("e42", "e321", vec!["-e431"]), ("e42", "e412", vec![]), ("e42", "e431", vec![]), ("e42", "e423", vec![]), ("e42", "e1234", vec![]), ("e42", "e5", vec!["e2", "e425"]), ("e42", "e15", vec!["e12", "-e4125"]), ("e42", "e25", vec!["e45", "-1"]), ("e42", "e35", vec!["e4235", "-e23"]), ("e42", "e45", vec!["e42"]), ("e42", "e235", vec!["e3", "e435"]), ("e42", "e315", vec!["-e321", "-e12345"]), ("e42", "e125", vec!["-e1", "-e415"]), ("e42", "e435", vec!["-e423"]), ("e42", "e425", vec!["-e4"]), ("e42", "e415", vec!["e412"]), ("e42", "e3215", vec!["e31", "-e4315"]), ("e42", "e4125", vec!["-e41"]), ("e42", "e4315", vec!["-e1234"]), ("e42", "e4235", vec!["e43"]), ("e42", "e12345", vec!["e431"]),
        ("e41", "1", vec!["e41"]), ("e41", "e1", vec!["e4"]), ("e41", "e2", vec!["e412"]), ("e41", "e3", vec!["-e431"]), ("e41", "e4", vec![]), ("e41", "e23", vec!["-e1234"]), ("e41", "e31", vec!["-e43"]), ("e41", "e12", vec!["e42"]), ("e41", "e43", vec![]), ("e41", "e42", vec![]), ("e41", "e41", vec![]), ("e41", "e321", vec!["-e423"]), ("e41", "e412", vec![]), ("e41", "e431", vec![]), ("e41", "e423", vec![]), ("e41", "e1234", vec![]), ("e41", "e5", vec!["e1", "e415"]), ("e41", "e15", vec!["e45", "-1"]), ("e41", "e25", vec!["e4125", "-e12"]), ("e41", "e35", vec!["e31", "-e4315"]), ("e41", "e45", vec!["e41"]), ("e41", "e235", vec!["-e321", "-e12345"]), ("e41", "e315", vec!["-e3", "-e435"]), ("e41", "e125", vec!["e2", "e425"]), ("e41", "e435", vec!["e431"]), ("e41", "e425", vec!["-e412"]), ("e41", "e415", vec!["-e4"]), ("e41", "e3215", vec!["e23", "-e4235"]), ("e41", "e4125", vec!["e42"]), ("e41", "e4315", vec!["-e43"]), ("e41", "e4235", vec!["-e1234"]), ("e41", "e12345", vec!["e423"]),
        ("e321", "1", vec!["e321"]), ("e321", "e1", vec!["-e23"]), ("e321", "e2", vec!["-e31"]), ("e321", "e3", vec!["-e12"]), ("e321", "e4", vec!["-e1234"]), ("e321", "e23", vec!["e1"]), ("e321", "e31", vec!["e2"]), ("e321", "e12", vec!["e3"]), ("e321", "e43", vec!["e412"]), ("e321", "e42", vec!["e431"]), ("e321", "e41", vec!["e423"]), ("e321", "e321", vec!["-1"]), ("e321", "e412", vec!["-e43"]), ("e321", "e431", vec!["-e42"]), ("e321", "e423", vec!["-e41"]), ("e321", "e1234", vec!["e4"]), ("e321", "e5", vec!["e3215"]), ("e321", "e15", vec!["-e235"]), ("e321", "e25", vec!["-e315"]), ("e321", "e35", vec!["-e125"]), ("e321", "e45", vec!["-e12345"]), ("e321", "e235", vec!["e15"]), ("e321", "e315", vec!["e25"]), ("e321", "e125", vec!["e35"]), ("e321", "e435", vec!["e4125"]), ("e321", "e425", vec!["e4315"]), ("e321", "e415", vec!["e4235"]), ("e321", "e3215", vec!["-e5"]), ("e321", "e4125", vec!["-e435"]), ("e321", "e4315", vec!["-e425"]), ("e321", "e4235", vec!["-e415"]), ("e321", "e12345", vec!["e45"]),
        ("e412", "1", vec!["e412"]), ("e412", "e1", vec!["-e42"]), ("e412", "e2", vec!["e41"]), ("e412", "e3", vec!["-e1234"]), ("e412", "e4", vec![]), ("e412", "e23", vec!["-e431"]), ("e412", "e31", vec!["e423"]), ("e412", "e12", vec!["-e4"]), ("e412", "e43", vec![]), ("e412", "e42", vec![]), ("e412", "e41", vec![]), ("e412", "e321", vec!["e43"]), ("e412", "e412", vec![]), ("e412", "e431", vec![]), ("e412", "e423", vec![]), ("e412", "e1234", vec![]), ("e412", "e5", vec!["e4125", "-e12"]), ("e412", "e15", vec!["-e2", "-e425"]), ("e412", "e25", vec!["e1", "e415"]), ("e412", "e35", vec!["-e321", "-e12345"]), ("e412", "e45", vec!["e412"]), ("e412", "e235", vec!["e31", "-e4315"]), ("e412", "e315", vec!["e4235", "-e23"]), ("e412", "e125", vec!["1", "-e45"]), ("e412", "e435", vec!["e1234"]), ("e412", "e425", vec!["-e41"]), ("e412", "e415", vec!["e42"]), ("e412", "e3215", vec!["e3", "e435"]), ("e412", "e4125", vec!["-e4"]), ("e412", "e4315", vec!["e423"]), ("e412", "e4235", vec!["-e431"]), ("e412", "e12345", vec!["-e43"]),
        ("e431", "1", vec!["e431"]), ("e431", "e1", vec!["e43"]), ("e431", "e2", vec!["-e1234"]), ("e431", "e3", vec!["-e41"]), ("e431", "e4", vec![]), ("e431", "e23", vec!["e412"]), ("e431", "e31", vec!["-e4"]), ("e431", "e12", vec!["-e423"]), ("e431", "e43", vec![]), ("e431", "e42", vec![]), ("e431", "e41", vec![]), ("e431", "e321", vec!["e42"]), ("e431", "e412", vec![]), ("e431", "e431", vec![]), ("e431", "e423", vec![]), ("e431", "e1234", vec![]), ("e431", "e5", vec!["e4315", "-e31"]), ("e431", "e15", vec!["e3", "e435"]), ("e431", "e25", vec!["-e321", "-e12345"]), ("e431", "e35", vec!["-e1", "-e415"]), ("e431", "e45", vec!["e431"]), ("e431", "e235", vec!["e4125", "-e12"]), ("e431", "e315", vec!["1", "-e45"]), ("e431", "e125", vec!["e23", "-e4235"]), ("e431", "e435", vec!["e41"]), ("e431", "e425", vec!["e1234"]), ("e431", "e415", vec!["-e43"]), ("e431", "e3215", vec!["e2", "e425"]), ("e431", "e4125", vec!["-e423"]), ("e431", "e4315", vec!["-e4"]), ("e431", "e4235", vec!["e412"]), ("e431", "e12345", vec!["-e42"]),
        ("e423", "1", vec!["e423"]), ("e423", "e1", vec!["-e1234"]), ("e423", "e2", vec!["-e43"]), ("e423", "e3", vec!["e42"]), ("e423", "e4", vec![]), ("e423", "e23", vec!["-e4"]), ("e423", "e31", vec!["-e412"]), ("e423", "e12", vec!["e431"]), ("e423", "e43", vec![]), ("e423", "e42", vec![]), ("e423", "e41", vec![]), ("e423", "e321", vec!["e41"]), ("e423", "e412", vec![]), ("e423", "e431", vec![]), ("e423", "e423", vec![]), ("e423", "e1234", vec![]), ("e423", "e5", vec!["e4235", "-e23"]), ("e423", "e15", vec!["-e321", "-e12345"]), ("e423", "e25", vec!["-e3", "-e435"]), ("e423", "e35", vec!["e2", "e425"]), ("e423", "e45", vec!["e423"]), ("e423", "e235", vec!["1", "-e45"]), ("e423", "e315", vec!["e12", "-e4125"]), ("e423", "e125", vec!["e4315", "-e31"]), ("e423", "e435", vec!["-e42"]), ("e423", "e425", vec!["e43"]), ("e423", "e415", vec!["e1234"]), ("e423", "e3215", vec!["e1", "e415"]), ("e423", "e4125", vec!["e431"]), ("e423", "e4315", vec!["-e412"]), ("e423", "e4235", vec!["-e4"]), ("e423", "e12345", vec!["-e41"]),
        ("e1234", "1", vec!["e1234"]), ("e1234", "e1", vec!["-e423"]), ("e1234", "e2", vec!["-e431"]), ("e1234", "e3", vec!["-e412"]), ("e1234", "e4", vec![]), ("e1234", "e23", vec!["e41"]), ("e1234", "e31", vec!["e42"]), ("e1234", "e12", vec!["e43"]), ("e1234", "e43", vec![]), ("e1234", "e42", vec![]), ("e1234", "e41", vec![]), ("e1234", "e321", vec!["-e4"]), ("e1234", "e412", vec![]), ("e1234", "e431", vec![]), ("e1234", "e423", vec![]), ("e1234", "e1234", vec![]), ("e1234", "e5", vec!["e321", "e12345"]), ("e1234", "e15", vec!["e23", "-e4235"]), ("e1234", "e25", vec!["e31", "-e4315"]), ("e1234", "e35", vec!["e12", "-e4125"]), ("e1234", "e45", vec!["e1234"]), ("e1234", "e235", vec!["e1", "e415"]), ("e1234", "e315", vec!["e2", "e425"]), ("e1234", "e125", vec!["e3", "e435"]), ("e1234", "e435", vec!["e412"]), ("e1234", "e425", vec!["431"]), ("e1234", "e415", vec!["423"]), ("e1234", "e3215", vec!["1", "-e45"]), ("e1234", "e4125", vec!["e43"]), ("e1234", "e4315", vec!["e42"]), ("e1234", "e4235", vec!["e41"]), ("e1234", "e12345", vec!["e4"]),
        ("e5", "1", vec!["e5"]), ("e5", "e1", vec!["-e15"]), ("e5", "e2", vec!["-e25"]), ("e5", "e3", vec!["-e35"]), ("e5", "e4", vec!["-1", "-e45"]), ("e5", "e23", vec!["e235"]), ("e5", "e31", vec!["e315"]), ("e5", "e12", vec!["e125"]), ("e5", "e43", vec!["e435", "-e3"]), ("e5", "e42", vec!["e425", "-e2"]), ("e5", "e41", vec!["e415", "-e1"]), ("e5", "e321", vec!["-e3215"]), ("e5", "e412", vec!["-e12", "-e4125"]), ("e5", "e431", vec!["-e31", "-e4315"]), ("e5", "e423", vec!["-e23", "-e4235"]), ("e5", "e1234", vec!["e12345", "-e321"]), ("e5", "e5", vec![]), ("e5", "e15", vec![]), ("e5", "e25", vec![]), ("e5", "e35", vec![]), ("e5", "e45", vec!["-e5"]), ("e5", "e235", vec![]), ("e5", "e315", vec![]), ("e5", "e125", vec![]), ("e5", "e435", vec!["-e35"]), ("e5", "e425", vec!["-e25"]), ("e5", "e415", vec!["-e15"]), ("e5", "e3215", vec![]), ("e5", "e4125", vec!["-e125"]), ("e5", "e4315", vec!["-e315"]), ("e5", "e4235", vec!["-e235"]), ("e5", "e12345", vec!["-e3215"]),
        ("e15", "1", vec!["e15"]), ("e15", "e1", vec!["-e5"]), ("e15", "e2", vec!["-e125"]), ("e15", "e3", vec!["e315"]), ("e15", "e4", vec!["e415", "-e1"]), ("e15", "e23", vec!["-e3215"]), ("e15", "e31", vec!["-e35"]), ("e15", "e12", vec!["e25"]), ("e15", "e43", vec!["e31", "e4315"]), ("e15", "e42", vec!["-e12", "-e4125"]), ("e15", "e41", vec!["-1", "-e45"]), ("e15", "e321", vec!["e235"]), ("e15", "e412", vec!["e425", "-e2"]), ("e15", "e431", vec!["e3", "-e435"]), ("e15", "e423", vec!["e321", "-e12345"]), ("e15", "e1234", vec!["e23", "e4235"]), ("e15", "e5", vec![]), ("e15", "e15", vec![]), ("e15", "e25", vec![]), ("e15", "e35", vec![]), ("e15", "e45", vec!["-e15"]), ("e15", "e235", vec![]), ("e15", "e315", vec![]), ("e15", "e125", vec![]), ("e15", "e435", vec!["e315"]), ("e15", "e425", vec!["-e125"]), ("e15", "e415", vec!["-e5"]), ("e15", "e3215", vec![]), ("e15", "e4125", vec!["-e25"]), ("e15", "e4315", vec!["e35"]), ("e15", "e4235", vec!["e3215"]), ("e15", "e12345", vec!["e235"]),
        ("e25", "1", vec!["e25"]), ("e25", "e1", vec!["e125"]), ("e25", "e2", vec!["-e5"]), ("e25", "e3", vec!["-e235"]), ("e25", "e4", vec!["e425", "-e2"]), ("e25", "e23", vec!["e35"]), ("e25", "e31", vec!["-e3215"]), ("e25", "e12", vec!["-e15"]), ("e25", "e43", vec!["-e23", "-e4235"]), ("e25", "e42", vec!["-1", "-e45"]), ("e25", "e41", vec!["e12", "e4125"]), ("e25", "e321", vec!["e315"]), ("e25", "e412", vec!["e1", "-e415"]), ("e25", "e431", vec!["e321", "-e12345"]), ("e25", "e423", vec!["e435", "-e3"]), ("e25", "e1234", vec!["e31", "e4315"]), ("e25", "e5", vec![]), ("e25", "e15", vec![]), ("e25", "e25", vec![]), ("e25", "e35", vec![]), ("e25", "e45", vec!["-e25"]), ("e25", "e235", vec![]), ("e25", "e315", vec![]), ("e25", "e125", vec![]), ("e25", "e435", vec!["-e235"]), ("e25", "e425", vec!["-e5"]), ("e25", "e415", vec!["e125"]), ("e25", "e3215", vec![]), ("e25", "e4125", vec!["e15"]), ("e25", "e4315", vec!["e3215"]), ("e25", "e4235", vec!["-e35"]), ("e25", "e12345", vec!["e315"]),
        ("e35", "1", vec!["e35"]), ("e35", "e1", vec!["-e315"]), ("e35", "e2", vec!["e235"]), ("e35", "e3", vec!["-e5"]), ("e35", "e4", vec!["e435", "-e3"]), ("e35", "e23", vec!["-e25"]), ("e35", "e31", vec!["e15"]), ("e35", "e12", vec!["-e3215"]), ("e35", "e43", vec!["-1", "-e45"]), ("e35", "e42", vec!["e23", "e4235"]), ("e35", "e41", vec!["-e31", "-e4315"]), ("e35", "e321", vec!["e125"]), ("e35", "e412", vec!["e321", "-e12345"]), ("e35", "e431", vec!["e415", "-e1"]), ("e35", "e423", vec!["e2", "-e425"]), ("e35", "e1234", vec!["e12", "e4125"]), ("e35", "e5", vec![]), ("e35", "e15", vec![]), ("e35", "e25", vec![]), ("e35", "e35", vec![]), ("e35", "e45", vec!["-e35"]), ("e35", "e235", vec![]), ("e35", "e315", vec![]), ("e35", "e125", vec![]), ("e35", "e435", vec!["-e5"]), ("e35", "e425", vec!["e235"]), ("e35", "e415", vec!["-e315"]), ("e35", "e3215", vec![]), ("e35", "e4125", vec!["e3215"]), ("e35", "e4315", vec!["-e15"]), ("e35", "e4235", vec!["e25"]), ("e35", "e12345", vec!["e125"]),
        ("e45", "1", vec!["e45"]), ("e45", "e1", vec!["-e415"]), ("e45", "e2", vec!["-e425"]), ("e45", "e3", vec!["-e435"]), ("e45", "e4", vec!["-e4"]), ("e45", "e23", vec!["e4235"]), ("e45", "e31", vec!["e4315"]), ("e45", "e12", vec!["e4125"]), ("e45", "e43", vec!["-e43"]), ("e45", "e42", vec!["-e42"]), ("e45", "e41", vec!["-e41"]), ("e45", "e321", vec!["-e12345"]), ("e45", "e412", vec!["-e412"]), ("e45", "e431", vec!["-e431"]), ("e45", "e423", vec!["-e423"]), ("e45", "e1234", vec!["-e1234"]), ("e45", "e5", vec!["e5"]), ("e45", "e15", vec!["e15"]), ("e45", "e25", vec!["e25"]), ("e45", "e35", vec!["e35"]), ("e45", "e45", vec!["1"]), ("e45", "e235", vec!["e235"]), ("e45", "e315", vec!["e315"]), ("e45", "e125", vec!["e125"]), ("e45", "e435", vec!["-e3"]), ("e45", "e425", vec!["-e2"]), ("e45", "e415", vec!["-e1"]), ("e45", "e3215", vec!["e3215"]), ("e45", "e4125", vec!["e12"]), ("e45", "e4315", vec!["e31"]), ("e45", "e4235", vec!["e23"]), ("e45", "e12345", vec!["-e321"]),

        // TODO
        ("e235", "1", vec![""]),
        ("e235", "e1", vec![""]),
        ("e235", "e2", vec![""]),
        ("e235", "e3", vec![""]),
        ("e235", "e4", vec![""]),
        ("e235", "e23", vec![""]),
        ("e235", "e31", vec![""]),
        ("e235", "e12", vec![""]),
        ("e235", "e43", vec![""]),
        ("e235", "e42", vec![""]),
        ("e235", "e41", vec![""]),
        ("e235", "e321", vec![""]),
        ("e235", "e412", vec![""]),
        ("e235", "e431", vec![""]),
        ("e235", "e423", vec![""]),
        ("e235", "e1234", vec![""]),
        ("e235", "e5", vec![""]),
        ("e235", "e15", vec![""]),
        ("e235", "e25", vec![""]),
        ("e235", "e35", vec![""]),
        ("e235", "e45", vec![""]),
        ("e235", "e235", vec![""]),
        ("e235", "e315", vec![""]),
        ("e235", "e125", vec![""]),
        ("e235", "e435", vec![""]),
        ("e235", "e425", vec![""]),
        ("e235", "e415", vec![""]),
        ("e235", "e3215", vec![""]),
        ("e235", "e4125", vec![""]),
        ("e235", "e4315", vec![""]),
        ("e235", "e4235", vec![""]),
        ("e235", "e12345", vec![""]),

        // TODO
        ("e1234", "1", vec![""]),
        ("e1234", "e1", vec![""]),
        ("e1234", "e2", vec![""]),
        ("e1234", "e3", vec![""]),
        ("e1234", "e4", vec![""]),
        ("e1234", "e23", vec![""]),
        ("e1234", "e31", vec![""]),
        ("e1234", "e12", vec![""]),
        ("e1234", "e43", vec![""]),
        ("e1234", "e42", vec![""]),
        ("e1234", "e41", vec![""]),
        ("e1234", "e321", vec![""]),
        ("e1234", "e412", vec![""]),
        ("e1234", "e431", vec![""]),
        ("e1234", "e423", vec![""]),
        ("e1234", "e1234", vec![""]),
        ("e1234", "e5", vec![""]),
        ("e1234", "e15", vec![""]),
        ("e1234", "e25", vec![""]),
        ("e1234", "e35", vec![""]),
        ("e1234", "e45", vec![""]),
        ("e1234", "e235", vec![""]),
        ("e1234", "e315", vec![""]),
        ("e1234", "e125", vec![""]),
        ("e1234", "e435", vec![""]),
        ("e1234", "e425", vec![""]),
        ("e1234", "e415", vec![""]),
        ("e1234", "e3215", vec![""]),
        ("e1234", "e4125", vec![""]),
        ("e1234", "e4315", vec![""]),
        ("e1234", "e4235", vec![""]),
        ("e1234", "e12345", vec![""]),
    ];
    let mut failures = 0;
    let mut correct_products = BTreeMap::new();
    for (a, b, products) in correct_cayley_table {
        let a = cga3d.parse(a);
        let b = cga3d.parse(b);
        let mut products_set = BTreeSet::new();
        for product in products {
            products_set.insert(cga3d.parse(product));
        }
        correct_products.insert((a.clone(), b.clone()), products_set);
    }

    for a in cga3d.sorted_basis() {
        for b in cga3d.sorted_basis() {
            let calculated_product: BTreeSet<BasisElement> = cga3d.product(&a, &b).into();
            let correct_product = correct_products.remove(&(a.clone(), b.clone())).expect("Cayley table must be complete");
            if calculated_product != correct_product {
                eprintln!("{a} * {b} was calculated as {calculated_product}, but we expected {correct_product}")
            }
        }
    }
    assert_eq!(failures, 0, "Conformal Geometric Product has {failures} errors.")
}